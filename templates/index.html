{% load compress %}
{% load static %}
<!doctype html>
<html>
<head>
  {% comment %}{% tailwind_css %}{% endcomment %}

  <title>{% block title %}{% endblock %}</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" />

  <script>
    // Global realtime client (session-auth via cookies).
    // Listens on ws(s)://<host>/ws/monitoring/ and dispatches window event 'monitoring:snapshot'.
    (function () {
      function wsUrl(path) {
        const proto = window.location.protocol === 'https:' ? 'wss' : 'ws';
        return `${proto}://${window.location.host}${path}`;
      }

      function connect() {
        const ws = new WebSocket(wsUrl('/ws/monitoring/'));

        ws.onmessage = (evt) => {
          try {
            const data = JSON.parse(evt.data);
            if (data && data.type === 'snapshot') {
              window.dispatchEvent(new CustomEvent('monitoring:snapshot', { detail: data }));
            }
          } catch (e) {
            console.error('WS parse error', e);
          }
        };

        ws.onclose = () => setTimeout(connect, 3000);
      }

      if (window.location.pathname.startsWith('/snmp/')) {
        connect();
      }
    })();
  </script>
  
</head>
  <body class="text-neutral-900 dark:text-neutral-300 bg-neutral-200 dark:bg-neutral-800">
  {% if user.is_authenticated %}
      {% include 'navbar.html' %}
      <!-- <div class="rounded-lg shadow-md"> -->
        {% block content %}
        {% endblock %}
      </div>

  {% else %}

      {% include 'login_page.html' %}

  {% endif %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
  </body>
</html>